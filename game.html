<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Crossing Quiz</title>
    <link rel="stylesheet" href="game.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- Custom font loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.3.0/fontfaceobserver.standalone.js"></script>
    <script src="./js/fontOptimizer.js"></script>
    <script src="./js/backgroundLoader.js"></script>
    <script src="./js/secureTokenManager.js"></script>
    
    <style>
      @font-face {
        font-family: 'customfont';
        src: url('./fonts/customfont.woff2') format('woff2'),
             url('./fonts/customfont.otf') format('opentype');
        font-display: swap;
        font-weight: normal;
        font-style: normal;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'customfont', Arial, sans-serif;
      }
      
      /* Apply custom font to all text elements */
      body, button, input, select, textarea, h1, h2, h3, h4, h5, h6, p, span, div, a, label, option, optgroup {
        font-family: 'customfont', Arial, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-synthesis: none;
        text-rendering: optimizeLegibility;
      }
      
      /* Fallback for font loading */
      .font-loading * {
        visibility: hidden;
      }
      
      html.font-fallback * {
        font-family: Arial, sans-serif;
      }

      /* CSS custom properties for dynamic background image selection */
      :root {
        --background-image: url('images/background.svg');
      }
      
      body {
        margin: 0;
        padding: 20px;
        background-color: #f0f8ff;
        color: #5a3d2b;
        background-image: url('images/background.svg');
        background-size: 100px 100px;
        background-repeat: repeat;
        background-attachment: scroll;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        transition: background-image 0.3s ease;
        /* Text rendering improvements */
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
      
      /* Progressive background loading */
      body.bg-loading {
        background-image: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 50%, #ddeeff 100%);
      }
      
      body.bg-loaded {
        background-image: var(--background-image);
      }
      
      /* Responsive background images */
      @media (max-width: 768px) {
        body.bg-loaded {
          background-image: var(--background-image);
          background-size: cover;
        }
      }
      
      @media (min-width: 769px) and (max-width: 1200px) {
        body.bg-loaded {
          background-image: var(--background-image);
        }
      }
      
      @media (min-width: 1201px) {
        body.bg-loaded {
          background-image: url("images/background.svg");
        }
      }
    </style>
    
    <!-- Sound effects -->
    <audio id="correct-sound" preload="auto">
        <source src="sounds/correct.ogg" type="audio/ogg">
    </audio>
    <div id="game-over" class="hidden rainbow-text">
        <audio preload="auto">
            <source src="sounds/game-over.ogg" type="audio/ogg">
        </audio>
    </div>
    <audio id="high-score-sound" preload="none">
        <source src="sounds/high-score.ogg" type="audio/ogg">
    </audio>
    <audio id="new-round-sound" preload="none">
        <source src="sounds/new-round.ogg" type="audio/ogg">
    </audio>
    <audio id="toggle-sound" preload="none">
        <source src="sounds/toggle.ogg" type="audio/ogg">
    </audio>
</head>
<body>
    <div id="fixed-nav-bar">
        <div class="nav-left">
            <a href="index.html" class="home-button">
                <img src="images/home.png" alt="Home" class="nav-icon">
                <span>Home</span>
            </a>
        </div>
        <div class="nav-center">
            <h1 class="rainbow-text">Animal Crossing Quiz</h1>
        </div>
        <div class="nav-right">
            <div class="sound-toggle" id="sound-toggle">
                <img src="images/speaker.png" alt="Sound">
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="game-container">
            <div class="game-header">
                <div class="score-container">
                    <div id="score">Score: <span id="score-value">0</span></div>
                    <div id="high-score">High Score: <span id="high-score-value">0</span></div>
                </div>
            </div>

            <div class="game-controls">
                <div class="category-selector">
                    <label for="category">Category:</label>
                    <select id="category" class="category-dropdown">
                        <option value="fish">Fish</option>
                        <option value="bugs">Bugs</option>
                        <option value="sea">Sea Creatures</option>
                        <option value="villagers">Villagers</option>
                    </select>
                </div>

                <div class="difficulty-selector">
                    <label for="difficulty">Difficulty:</label>
                    <select id="difficulty" class="category-dropdown">
                        <option value="5000">Easy (15s)</option>
                        <option value="10000" selected>Medium (10s)</option>
                        <option value="15000">Hard (5s)</option>
                    </select>
                </div>
                
                <div class="timer-container">
                    <div id="game-timer">Time: <span id="time">30</span>s</div>
                </div>
            </div>

            <div class="game-area">
                <div class="image-container">
                    <img id="image-display" src="" alt="Animal Crossing character or item">
                </div>

                <div id="question" class="question"></div>
                <div class="input-container">
                    <input type="text" id="guess-input" placeholder="Who's that villager?" autocomplete="off">
                </div>
                <div id="feedback" class="feedback"></div>
                <div class="controls">
                    <button id="game-action-btn" class="btn btn-primary">Start Game</button>
                </div>
            </div>

            <div class="leaderboard-container" style="margin-top: 20px;">
                <h3>Top Scores</h3>
                <ul id="leaderboard" class="leaderboard-list">
                    <!-- Leaderboard entries will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Game script must be loaded last -->
    <script type="module" src="game.js"></script>
    
    <!-- Font loading script -->
    <script>
      // Add font loading class to handle FOUT (Flash of Unstyled Text)
      document.documentElement.classList.add('font-loading');
      
      // Load custom font
      const customFont = new FontFaceObserver('customfont');
      
      Promise.all([
        customFont.load(),
        document.fonts.ready
      ]).then(() => {
        document.documentElement.classList.remove('font-loading');
        document.documentElement.classList.add('fonts-loaded');
      }).catch((err) => {
        console.warn('Font loading failed, using fallback font', err);
        document.documentElement.classList.remove('font-loading');
        document.documentElement.classList.add('font-fallback');
      });
    </script>
    
    <!-- Game Mode Configuration -->
    <script>
      // Set backend URL - use Railway URL in production, fallback to localhost in development
      const BACKEND_URL = window.location.hostname === 'localhost' 
        ? 'http://localhost:8000' 
        : 'https://capstone-project-production-3cce.up.railway.app';
      
      // Always use local storage for game data
      window.standaloneMode = true;
    </script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Sound toggle functionality
        const soundToggle = document.querySelector('.sound-toggle');
        if (soundToggle) {
          soundToggle.addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof soundManager !== 'undefined') {
              soundManager.toggle();
              
              // Update button image
              const img = this.querySelector('img');
              if (img) {
                img.src = soundManager.enabled ? 'images/speaker.png' : 'images/speaker-mute.png';
              }
            }
          });
        }
        
        // Home button functionality
        const homeButton = document.querySelector('.home-button');
        if (homeButton) {
          homeButton.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'index.html';
          });
        }
      });
    </script>
</body>
</html>
